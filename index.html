<!DOCTYPE html>
<html lang="zh">
<head>
    <script src="https://unpkg.com/vue"></script>
</head>
<body>
    <div id="app">
        <input size="40" v-model="textInput" placeholder="输入语音文字" />
        <button v-on:click="post_text">转换为音频</button>
        <br>
        <div v-if="loading">
            <br>
            <div id="loader" class="loader"></div>
        </div>
        <div v-if="!loading">
            <br>
            <audio id="audio" autoplay="true" controls="" v-bind:src="'data:audio/mpeg;base64,' + audioData">
                The “audio” tag is not supported by your browser.
            </audio>
        </div>
    </div>
</body>
<style>
    .loader {
        border: 5px solid #f3f3f3;
        border-radius: 50%;
        border-top: 5px solid #3498db;
        width: 30px;
        height: 30px;
        -webkit-animation: spin 1s linear infinite;
        /* Safari */
        animation: spin 1s linear infinite;
    }

    /* Safari */
    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }
</style>
<script>
    var app = new Vue({
        el: '#app',
        data: {
            audioData: '',
            textInput: '',
            loading: false
        },
        methods: {
            post_text: function (event) {
                console.log(this.textInput)
                this.loading = true
                fetch('/api/tencent.py?text=' + this.textInput)
                    .then(response => response.json())
                    .then(json => {
                        console.log(json)
                        this.product = json
                        this.description = json.payload.speech_base64
                        this.audioData = json.payload.speech_base64
                    })
                    .catch(e => this.description = e)
                    .finally(_ => {
                        console.log("Finished")
                        this.loading = false
                    })
            }
        }
    })
</script>
</html>